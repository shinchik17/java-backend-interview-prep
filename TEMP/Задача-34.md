#### 34. –ó–∞–¥–∞—á–∞. –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–∫–∞. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤, start, join, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–≤. –ß—Ç–æ –≤—ã–≤–µ–¥–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª—å?

```java
class Scratch {
    public static volatile int counter = 0;

    public static void main(String[] args) throws InterruptedException {
        var t1 = new Thread(() -> {
            for (int i = 0; i < 1000; i++) {
                increaseCounter();
            }
        });

        var t2 = new Thread(() -> {
            for (int i = 0; i < 1000; i++) {
                increaseCounter();
            }
        });

        t1.start();
        t2.start();

        t1.join();
        t2.join();

        System.out.println(counter);
    }

    public static void increaseCounter() {
        counter++;
    }
}

```


{{< hint warning >}}
**–°–ø–æ–π–ª–µ—Ä—ã –∫ —Ä–µ—à–µ–Ω–∏—é** ¬†
{{< /hint >}}

{{< details "–ü–æ–¥—Å–∫–∞–∑–∫–∏" close >}}
üîπ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `counter` –æ–±—ä—è–≤–ª–µ–Ω–∞ –∫–∞–∫ **volatile**, –Ω–æ —ç—Ç–æ **–Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å** –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞ (`counter++`).  
üîπ `counter++` —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ **—Ç—Ä–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**: —á—Ç–µ–Ω–∏–µ, —É–≤–µ–ª–∏—á–µ–Ω–∏–µ, –∑–∞–ø–∏—Å—å. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ **–ø–æ–¥–≤–µ—Ä–∂–µ–Ω–Ω—ã–º –≥–æ–Ω–∫–µ –ø–æ—Ç–æ–∫–æ–≤**.  
üîπ –û–∂–∏–¥–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ **–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 2000**, –Ω–æ –∏–∑-–∑–∞ –≥–æ–Ω–∫–∏ –ø–æ—Ç–æ–∫–æ–≤ **–º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω—å—à–µ**.

{{< /details >}}

{{< details "–†–µ—à–µ–Ω–∏–µ" close >}}
–û—à–∏–±–∫–∞ –≤ **–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**. –†–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É –º–æ–∂–Ω–æ —Ç—Ä–µ–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:

1Ô∏è‚É£ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `synchronized`**

```java
public static synchronized void increaseCounter() {
    counter++;
}
```

üí° **–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å, –Ω–æ —Å–Ω–∏–∂–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –∏–∑-–∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.

2Ô∏è‚É£ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `AtomicInteger`**

```java
import java.util.concurrent.atomic.AtomicInteger;

class Scratch {
    public static AtomicInteger counter = new AtomicInteger(0);

    public static void main(String[] args) throws InterruptedException {
        var t1 = new Thread(() -> {
            for (int i = 0; i < 1000; i++) {
                counter.incrementAndGet();
            }
        });

        var t2 = new Thread(() -> {
            for (int i = 0; i < 1000; i++) {
                counter.incrementAndGet();
            }
        });

        t1.start();
        t2.start();

        t1.join();
        t2.join();

        System.out.println(counter.get());
    }
}
```

‚úÖ **–õ—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç**, —Ç–∞–∫ –∫–∞–∫ `AtomicInteger` **–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å** –∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.

3Ô∏è‚É£ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ReentrantLock`**

```java
import java.util.concurrent.locks.ReentrantLock;

class Scratch {
    public static int counter = 0;
    private static final ReentrantLock lock = new ReentrantLock();

    public static void main(String[] args) throws InterruptedException {
        var t1 = new Thread(() -> {
            for (int i = 0; i < 1000; i++) {
                increaseCounter();
            }
        });

        var t2 = new Thread(() -> {
            for (int i = 0; i < 1000; i++) {
                increaseCounter();
            }
        });

        t1.start();
        t2.start();

        t1.join();
        t2.join();

        System.out.println(counter);
    }

    public static void increaseCounter() {
        lock.lock();
        try {
            counter++;
        } finally {
            lock.unlock();
        }
    }
}
```

üîπ **–ì–∏–±–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç**, –Ω–æ —Å–ª–æ–∂–Ω–µ–µ `AtomicInteger`.

üí° **–í—ã–≤–æ–¥:** –ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–¥ –±–µ–∑ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç **–Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º** (<2000). –õ—É—á—à–∏–π –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **AtomicInteger**! üöÄ
{{< /details >}}

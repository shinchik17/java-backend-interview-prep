#### 41. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –±–æ–ª–µ–µ —á–µ–º –æ–¥–Ω–æ–π –ø–æ–∫—É–ø–∫–æ–π –≤ –¥–µ–Ω—å

**–£—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏:**  
üìå –ï—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ `T1(date, user_id)` —Å –¥–∞—Ç–∞–º–∏ –ø–æ–∫—É–ø–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
```

date | user_id  
------------+---------  
2017-01-01 | user1  
2017-01-01 | user1  
2017-01-02 | user1  
2017-01-01 | user2  
2017-01-02 | user2  
2017-01-03 | user3

````
–ù—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤—Å–µ —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–≤–µ—Ä—à–∏–ª –±–æ–ª–µ–µ –æ–¥–Ω–æ–π –ø–æ–∫—É–ø–∫–∏ –≤ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –¥–µ–Ω—å, –∏ –≤—ã–≤–µ—Å—Ç–∏ –ø–∞—Ä—ã `(date, user_id)`.

{{< hint warning >}}  
**–°–ø–æ–π–ª–µ—Ä—ã –∫ —Ä–µ—à–µ–Ω–∏—é**  
{{< /hint >}}

{{< details "–ü–æ–¥—Å–∫–∞–∑–∫–∏" close >}}  
üí° –ü–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ `(date, user_id)` –∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å `HAVING COUNT(*) > 1`.  
üí° –í—Ç–æ—Ä–æ–π –≤–∞—Ä–∏–∞–Ω—Ç (–±–µ–∑ `GROUP BY`): –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–∫–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `COUNT(*) OVER (PARTITION BY date, user_id)`.  
{{< /details >}}

{{< details "–†–µ—à–µ–Ω–∏–µ" close >}}
```sql
-- –í–∞—Ä–∏–∞–Ω—Ç 1: GROUP BY + HAVING
SELECT
    date,
    user_id
FROM T1
GROUP BY
    date,
    user_id
HAVING COUNT(*) > 1;

-- –í–∞—Ä–∏–∞–Ω—Ç 2: –û–∫–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (–±–µ–∑ GROUP BY)
SELECT DISTINCT
    date,
    user_id
FROM (
    SELECT
        date,
        user_id,
        COUNT(*) OVER (PARTITION BY date, user_id) AS purchase_count
    FROM T1
) sub
WHERE purchase_count > 1;
````

{{< /details >}}


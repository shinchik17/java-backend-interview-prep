#### 56. Self‚Äëinject –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–£—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏:**  
–î–∞–Ω –∫–æ–¥. –ï—Å—Ç—å —Å–µ—Ä–≤–∏—Å —Å –¥–≤—É–º—è –º–µ—Ç–æ–¥–∞–º–∏ a() –∏ b(). –ò–∑ b() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è a(). –ï—Å–ª–∏ –∏–∑–≤–Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ b(), —Å–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π? –ö–∞–∫ –ø–æ–ø—Ä–∞–≤–∏—Ç—å —Ç–æ—Ç —Ñ–∞–∫—Ç, —á—Ç–æ –≤ —Ç–∞–∫–æ–º –≤—ã–∑–æ–≤–µ –±—É–¥–µ—Ç 0 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π, —á—Ç–æ–±—ã proxy —Å–æ–∑–¥–∞–ª—Å—è –∏ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–∞ –≤—Å—è –ª–æ–≥–∏–∫–∞?  –ù–∞–ø–∏—à–∏ self-inject


**–ö–æ–¥:**

```java
@Service
class SomeService {
    @Transactional
    public void a() {}

    public void b() {
        a();
    }
}

SomeService.b();
````

{{< hint warning >}}  
**–°–ø–æ–π–ª–µ—Ä—ã –∫ —Ä–µ—à–µ–Ω–∏—é**  
{{< /hint >}}

{{< details "–ü–æ–¥—Å–∫–∞–∑–∫–∏" close >}}  
üí° Spring AOP —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–∫—Å–∏ –≤–æ–∫—Ä—É–≥ –±–∏–Ω–∞ –∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ **–≤–Ω–µ—à–Ω–∏–µ** –≤—ã–∑–æ–≤—ã.  
üí° –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ `this.a()` **–æ–±—Ö–æ–¥–∏—Ç** –ø—Ä–æ–∫—Å–∏, –ø–æ—ç—Ç–æ–º—É –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è `@Transactional` –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è.  
üí° –ù—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å `a()` —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏-–±–∏–Ω: –≤–Ω–µ–¥—Ä–∏—Ç—å —Å–∞–º `SomeService` –≤ –Ω–µ–≥–æ –∂–µ (self‚Äëinjection).  
{{< /details >}}

{{< details "–†–µ—à–µ–Ω–∏–µ" close >}}

```java
@Service
public class SomeService {
    // self‚Äëinject –ø—Ä–æ–∫—Å–∏
    private final SomeService self;

    public SomeService(SomeService self) {
        this.self = self;
    }

    @Transactional
    public void a() {
        // –ª–æ–≥–∏–∫–∞, —Ä–∞–±–æ—Ç–∞—é—â–∞—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
    }

    public void b() {
        // –≤–º–µ—Å—Ç–æ this.a() –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏
        self.a();
    }
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

- –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `someService.b()` –≤–Ω–µ—à–Ω–µ ‚Äì —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–∞ `b()` –Ω–µ –Ω—É–∂–Ω–∞.

- –í–Ω—É—Ç—Ä–∏ `b()` –≤—ã–∑–æ–≤ `self.a()` –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ Spring‚Äë–ø—Ä–æ–∫—Å–∏, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç `@Transactional` –Ω–∞ `a()` —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.


–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, **–æ–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è** –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è –º–µ—Ç–æ–¥–∞ `a()`.  
{{< /details >}}